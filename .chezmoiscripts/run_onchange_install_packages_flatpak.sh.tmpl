#!/bin/bash

{{- if ge .level 2}}

if ! command -v flatpak >/dev/null 2>&1; then
  echo
  echo ">>>flatpak package manager could not be found, starting installation"
  echo
  packinstall flatpak
  echo
fi

flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
echo

xargs flatpak install -y </dev/stdin <<EOF
{{if (and (ge .level 2) (hasKey .packages.flatpak "level2"))}}
  {{ range .packages.flatpak.level2 -}}
    {{ . }}
  {{ end -}}
{{- end -}}
{{if (and (ge .level 3) (hasKey .packages.flatpak "level3"))}}
  {{ range .packages.flatpak.level3 -}}
    {{ . }}
  {{ end -}}
{{- end -}}
EOF
{{- end -}}
